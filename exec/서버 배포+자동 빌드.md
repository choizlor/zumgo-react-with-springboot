# Jenkins ì„œë²„ ë°°í¬ ë° ìë™ ë¹Œë“œ
---
## ğŸ“Œ ëª©ì°¨
[1. Jenkins ì„¤ì¹˜](#1-jenkins-ì„¤ì¹˜)   
[2. Jenkins ì ‘ì†](#2-jenkins-ì ‘ì†)   
[3. GitLab ì—°ê²°](#3-gitlab-ì—°ê²°)   
[4. Repository ì—°ê²°](#4-repository-ì—°ê²°)   
[5. ì›¹í›… ì—°ê²°](#5-ì›¹í›…-ì—°ê²°)   
[6. ìë™ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸](#6-ìë™-ë°°í¬-ìŠ¤í¬ë¦½íŠ¸)   
[7. Nginx ì„¤ì •](#7-Nginx-ì„¤ì •)   
<br/>

## 1. Jenkins ì„¤ì¹˜
- jenkins ì´ë¯¸ì§€ ë‹¤ìš´
```bash
$ docker pull jenkins/jenkins:lts
```
- jenkins ì»¨í…Œì´ë„ˆ ë“±ë¡ í›„ ì‹¤í–‰
```bash
$ docker run -d -p 9090:8080 -v /jenkins:/var/jenkins_home --name jenkins -u root jenkins/jenkins:lts
```
<br/>

## 2. Jenkins ì ‘ì†
- url: "í¼ë¸”ë¦­ IPv4 ì£¼ì†Œ:9090" ìœ¼ë¡œ ì ‘ì†
- jenkins bash ì ‘ì† í›„ password ì°¾ê¸°
```bash
$ docker exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword
```
<br/>

## 3. GitLab ì—°ê²°
- gitlab token ë°œê¸‰   
<br/>

![token](/images/token.JPG)
<br/>

- Jenkins ê´€ë¦¬ - Manage Credentialsë¡œ ì´ë™ -> globalì—ì„œ Add credentials í´ë¦­ -> GitLab API token ë“±ë¡
<br/>

![token_ë“±ë¡](/images/jenkins_tokenë“±ë¡.JPG)
<br/>

- Jenkins ê´€ë¦¬ - ì‹œìŠ¤í…œ ì„¤ì • - Gitlab
<br/>

![Gitlab_ì—°ê²°](/images/gitlab_ì—°ê²°.JPG)

```bash
```
<br/>


## 4. Repository ì—°ê²°
- item ìƒì„±
<br/>

![item_ìƒì„±](/images/itemìƒì„±.JPG)
<br/>

- ì €ì¥ì†Œì™€ ì—°ë™í•˜ê¸° ìœ„í•œ Credentialì„ ë”°ë¡œ ì¶”ê°€ => Credentials ë¶€ë¶„ì—ì„œ Add - Jenkins
```
Kind: Username with password   
Scope: Global   
Username: [ê¹ƒë© ì•„ì´ë””]   
Password: [gitlabì—ì„œ ë°›ì€ access token ê°’]   
```
<br/>

- repository ì—°ê²°
<br/>

![repository_ì—°ê²°](/images/repositoryì—°ê²°.JPG)
<br/>

## 5. ì›¹í›… ì—°ê²°
- ë¹Œë“œ ìœ ë°œ - url ë³µì‚¬ & ë¹Œë“œ ìœ ë°œ - ê³ ê¸‰ - Secret token - Generate í›„, ë³µì‚¬
<br/>

![ì›¹í›…_url](/images/webhook_url.jpg)
<br/>

- gitlab ì›¹í›… ì„¤ì • => ë³µì‚¬í•´ ë†“ì€ ê°’ ë¶™ì—¬ë„£ê¸°
<br/>

![ì›¹í›…ì„¤ì •](/images/webhookì„¤ì •.JPG)
<br/>

## 6. ìë™ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
- í•´ë‹¹ ë‹¨ê³„ë¥¼ ì§„í–‰í•˜ê¸° ì „ì— ê° í´ë”ì— Dockerfileì´ ì‘ì„±ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.
- Build Steps - Execute shell ì„ íƒ => ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬, ë¶™ì—¬ë„£ê¸°
```bash
docker build -t backimg ./backend
if (docker ps | grep "backimg"); then docker stop backimg; fi
docker run -it -d --rm -p 8080:8080 --name backimg backimg
echo "Run testproject"

docker build -t frontimg ./frontend
if (docker ps | grep "frontimg"); then docker stop frontimg; fi
docker run -it -d --rm -p 3000:3000 --name frontimg frontimg
echo "Run testproject_react"
```
<br/>

![ìë™ë°°í¬](/images/ìë™ë°°í¬.JPG)
<br/>

## 7. Nginx ì„¤ì •
- Reactì™€ Spring Boot ê²½ë¡œ ì„¤ì •
```bash
upstream backend{
	ip_hash;
	server "EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ Private ip ì£¼ì†Œ":8080;
}

server {
    listen       3000;
    listen  [::]:3000;
    server_name  "ìš°ë¦¬ ì„œë²„ url";

    #access_log  /var/log/nginx/host.access.log  main;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
        try_files $uri $uri/ /index.html;
    }

	location /api {
        proxy_pass http://backend/;
        proxy_redirect     off;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}
```
